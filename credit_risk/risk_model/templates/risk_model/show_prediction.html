<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Risk Prediction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        h1 {
            color: #6a1b9a;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #6a1b9a;
            border-color: #6a1b9a;
        }
        .btn-primary:hover {
            background-color: #4a148c;
            border-color: #4a148c;
        }
        .btn-secondary {
            background-color: #ccc;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #aaa;
        }
        .spacer {
            margin-top: 20px;
        }
        .loading-section {
            margin-top: 20px;
            text-align: center;
        }

        .shap_plot {
            width: 80%;
            max-width: 600;
            margin: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Credit Risk Prediction</h1>
        <p>The predicted risk rating is: <strong>{{ prediction }}</strong></p>
        
        <img src="{{ shap_waterfall_plot }}" alt="SHAP waterfall plot" class="shap_plot">
        
        <p>
            The waterfall plot is used to help show how different financial features has contributed to your risk rating ({{ prediction }}).
            The red bar indicates factors increasing your risk, while blue bar indicate factors lowering your risk.
            By understanding these contributions, you can take into account how to properly improve your risk profile.
        </p>

        <p>{{ waterfall_explanation|safe }}</p>

        <h3>Suggestions</h3>
        <div class="suggestions">
            {% for sugg in suggestions %}
            <div class="suggestion-items">
                <p class="Feature">{{ sugg }}</p>
            </div>
            {% empty %}
                <p>No specific recommendations</p>
            {% endfor %}
        </div>
        <!-- Save Prediction Button -->
        <form method="POST" action="{% url 'save_prediction' %}">
            {% csrf_token %}
            <input type="hidden" name="user_input_id" value="{{ user_input.id }}"> <!-- Pass UserInput ID -->
            <input type="hidden" name="prediction" value="{{ prediction }}"> <!-- Pass Prediction -->
            <button type="submit" class="btn btn-primary">Save this Prediction</button>
        </form>

        <div class="spacer">
            <a href="{% url 'main_page' %}" class="btn btn-secondary">Back to Form</a>
        </div>

        <!-- Additional Section for Exporting to PDF -->
        <div class="loading-section">
            <h3>Predicted Credit Risk Rating</h3>
            <p>Loading...</p> <!-- Placeholder for report generation -->
            <a href="{% url 'export_to_pdf' %}" class="btn btn-primary">Print to PDF</a>
        </div>
    </div>
</body>
</html>
